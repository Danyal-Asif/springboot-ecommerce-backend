<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Page</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
</head>

<body>
    <br/>
    <div class="container">
        <div class="d-flex justify-content-between align-items-center mb-3">
        <h5 style="justify-content: center; text-align: center;" th:text="${name}"></h5>
        <a th:href="@{/cart/mycart}" class="btn btn-outline-dark btn-sm">
            ðŸ›’ My Cart
        </a>
    </div>

    <!-- Filter Form -->
    <form th:action="@{/products/catPd}" method="get"
          class="d-flex align-items-center gap-2 mb-3">

        <label class="fw-bold mb-0">Filter:</label>

        <select name="pCategory" class="form-select form-select-sm w-25">
            <option value="">All Categories</option>
            <option th:each="cat : ${categories}"
                    th:value="${cat}"
                    th:text="${cat}">
            </option>
        </select>

        <button type="submit" class="btn btn-sm btn-primary">
            Search
        </button>
    </form>


    <div class="card shadow-sm">
        <div class="card-body">
            <form th:action="@{/cart/add}" method="post">
        <table class="table table-bordered table-striped table-sm align-middle">
            <thead class="table-dark">
                <tr>
                    <th style="width: 35%">Title</th>
                    <th style="width: 15%">Category</th>
                    <th style="width: 10%" class="text-center">Stock</th>
                    <th style="width: 10%" class="text-end">Price</th>
                    <th style="width: 15%" class="text-center">Action</th>
                </tr>
            </thead>
            <tbody>
                <tr th:if="${products.empty}">
                    <td colspan="5">No Products</td>
                </tr>
                <tr th:each="product : ${products}">
    <td th:text="${product.name}"></td>

    <td>
        <span class="badge bg-secondary"
              th:text="${product.category}"></span>
    </td>

    <td class="text-center"
        th:text="${product.inStock > 0 ? product.inStock : 'Out of Stock'}"
        th:classappend="${product.inStock > 0 ? ' text-success' : ' text-danger'}">
    </td>

    <td class="text-end">
        $<span th:text="${product.price}"></span>
    </td>

    <td class="text-center">
        <form th:action="@{/cart/add}" method="post">
            <input type="hidden" name="productId"
                   th:value="${product.id}" />
            <button type="submit"
                    class="btn btn-sm btn-success"
                    th:disabled="${product.inStock == 0}">
                Add to Cart
            </button>
        </form>
    </td>
</tr>
            </tbody>
        </table>
        </form>
    </div>
    </div>
</div>

</body>

</html>